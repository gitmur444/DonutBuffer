# üöÄ **Smart SQL Tool Implementation**

## üìã **–ü—Ä–æ–±–ª–µ–º–∞**

AI Test Planner –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã:
```sql
-- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –Ω–µ –≤—Å–µ 26 —Ç–µ—Å—Ç–æ–≤
SELECT test_name, status, execution_time_ms, last_run FROM actual_tests

-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤—Å–µ 26 —Ç–µ—Å—Ç–æ–≤  
SELECT test_suite, test_name, status, execution_time_ms, last_run FROM actual_tests
```

**–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã**: –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ `actual_tests` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–∞—Ä–æ–π `(test_suite, test_name)`, –Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –∑–Ω–∞–ª –æ–± —ç—Ç–æ–º.

## üéØ **–†–µ—à–µ–Ω–∏–µ: Smart SQL Tool**

### **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:**
```
Intent ‚Üí Schema Analysis ‚Üí SQL Generation ‚Üí Execution
```

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```python
class SafeSQLTool:
    # –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
    execute({"sql": "SELECT ..."})
    
    # –ù–æ–≤—ã–π Smart SQL —Ä–µ–∂–∏–º  
    execute({"intent": "–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã", "context": "..."})
```

## üîß **–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

### **1. Schema Analysis**
- **Fingerprinting**: MD5 —Ö–µ—à —Å—Ç—Ä—É–∫—Ç—É—Ä—ã + –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
- **Caching**: 5-–º–∏–Ω—É—Ç–Ω—ã–π TTL –∫–µ—à
- **Context Generation**: –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, constraints, –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### **2. Intent-to-SQL Generation**
```python
def generate_sql_from_intent(intent: str, context: str = "") -> str:
    schema_context = self.get_fresh_schema_context()
    
    prompt = f"""
    –ö–û–ù–¢–ï–ö–°–¢ –ë–ê–ó–´ –î–ê–ù–ù–´–•: {schema_context}
    –ù–ê–ú–ï–†–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {intent}
    
    –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
    1. –î–ª—è actual_tests –í–°–ï–ì–î–ê –≤–∫–ª—é—á–∞–π test_suite –≤ SELECT
    2. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–∞—Ä–æ–π (test_suite, test_name)
    """
    
    return llm_generate_sql(prompt)
```

### **3. Hybrid Execution**
- **Backward Compatible**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ `{"sql": "..."}` –∑–∞–ø—Ä–æ—Å—ã
- **Smart Mode**: –ù–æ–≤—ã–µ `{"intent": "..."}` –∑–∞–ø—Ä–æ—Å—ã

## üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

### **–î–æ Smart SQL:**
```bash
python ai_test_planner.py "–ø–æ–∫–∞–∂–∏ –≤—Å–µ 26 —Ç–µ—Å—Ç–æ–≤"
# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª: SELECT test_name FROM actual_tests  
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—É—Ç–∞–Ω–∏—Ü–∞ —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
```

### **–ü–æ—Å–ª–µ Smart SQL:**
```bash
python ai_test_planner.py "–ö–∞–∫–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —É –º–µ–Ω—è –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ"
# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª: SELECT test_suite, test_name, status, execution_time_ms, last_run FROM actual_tests
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –í—Å–µ 26 —Ç–µ—Å—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã
```

## üéä **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**

### ‚úÖ **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:**
- **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π SQL**: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç `test_suite` 
- **–í—Å–µ 26 —Ç–µ—Å—Ç–æ–≤**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—Ç–∞—Ä—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –ë–î
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ read-only –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:**
- **Intent-based –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–æ–ª–Ω–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫
- **Schema-aware**: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏**: –£—á–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏

## üìà **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —É–∑–ª–æ–≤:**

### **–í examples.py:**
```python
# –ù–æ–≤—ã–µ intent-based –ø—Ä–∏–º–µ—Ä—ã
{"id": "query1", "type": "TestDB", "params": {"intent": "–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏"}}
{"id": "query2", "type": "TestDB", "params": {"intent": "–Ω–∞–π—Ç–∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã", "context": "–Ω—É–∂–µ–Ω –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º"}}
```

## üîÑ **Workflow:**

### **Smart SQL Process:**
1. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Smart SQL Tool** –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –ë–î
3. **LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç** –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SQL —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
4. **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è** –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
5. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è** –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## üöÄ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

### **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
1. **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ intent**: –ó–∞—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ intent-based –ø—Ä–∏–º–µ—Ä—ã
2. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–≤—è–∑—è—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
3. **Query optimization**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Error handling**: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ SQL –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üí° **–ö–ª—é—á–µ–≤—ã–µ —É—Ä–æ–∫–∏:**

1. **Schema-aware AI**: LLM –Ω—É–∂–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
2. **Hybrid approach**: –°–æ—á–µ—Ç–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
3. **Incremental adoption**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. **Caching strategy**: –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

---

**üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞: AI Test Planner —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ 26 —Ç–µ—Å—Ç–æ–≤!** 